"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4417],{28453:(e,i,s)=>{s.d(i,{R:()=>n,x:()=>l});var t=s(96540);const c={},r=t.createContext(c);function n(e){const i=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:n(e.components),t.createElement(r.Provider,{value:i},e.children)}},96235:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>n,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"gists/Trust new CA Cerificate","title":"Trust new CA Cerificate","description":"It is common in corporates to use endpoint protection and tracking tools like Fortinet to manage the system as well as access to different sites in the internet. They may issue new certificates that need to be installed in the linux systems separately. To do that, follow","source":"@site/docs/gists/trust_CA_Certificate.md","sourceDirName":"gists","slug":"/gists/Trust new CA Cerificate","permalink":"/docs/gists/Trust new CA Cerificate","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"Trust new CA Cerificate","title":"Trust new CA Cerificate","sidebar_label":"Trust new CA Cerificate"},"sidebar":"tutorialSidebar","previous":{"title":"TF Neural Net","permalink":"/docs/gists/NeuralNet"},"next":{"title":"Update Grub (Linux)","permalink":"/docs/gists/update_grub_linux"}}');var c=s(74848),r=s(28453);const n={id:"Trust new CA Cerificate",title:"Trust new CA Cerificate",sidebar_label:"Trust new CA Cerificate"},l=void 0,a={},o=[{value:"Copy the certificate from issuer",id:"copy-the-certificate-from-issuer",level:2},{value:"Put the CA file in <code>ca-certificates</code> folder",id:"put-the-ca-file-in-ca-certificates-folder",level:2},{value:"Update the ca-certificates",id:"update-the-ca-certificates",level:2},{value:"Check if CA-Certificate is working",id:"check-if-ca-certificate-is-working",level:2},{value:"Check if CA file is readable by the current user",id:"check-if-ca-file-is-readable-by-the-current-user",level:2},{value:"Check the CA file permissions",id:"check-the-ca-file-permissions",level:2},{value:"Change the mode",id:"change-the-mode",level:3},{value:"Check if it CA-Certificate is working",id:"check-if-it-ca-certificate-is-working",level:2},{value:"Add Shell Variables",id:"add-shell-variables",level:2},{value:"Sample Usecase",id:"sample-usecase",level:2},{value:"Docker Image building",id:"docker-image-building",level:3},{value:"Docker Compose",id:"docker-compose",level:3}];function d(e){const i={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(i.p,{children:["It is common in corporates to use endpoint protection and tracking tools like ",(0,c.jsx)(i.code,{children:"Fortinet"})," to manage the system as well as access to different sites in the internet. They may issue new certificates that need to be installed in the linux systems separately. To do that, follow"]}),"\n",(0,c.jsx)(i.h2,{id:"copy-the-certificate-from-issuer",children:"Copy the certificate from issuer"}),"\n",(0,c.jsx)(i.p,{children:"It can be copied to any folder such as Downloads or Documents"}),"\n",(0,c.jsx)(i.p,{children:"This is done to make a local copy of the certificate, if you're copying it from a network folder."}),"\n",(0,c.jsx)(i.p,{children:"If you don't want a copy, directly copy the file from source to destination using next step."}),"\n",(0,c.jsxs)(i.h2,{id:"put-the-ca-file-in-ca-certificates-folder",children:["Put the CA file in ",(0,c.jsx)(i.code,{children:"ca-certificates"})," folder"]}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"sudo cp CA_Certificate.cer /usr/local/share/ca-certificates/CA_Certificate.crt\n"})}),"\n",(0,c.jsx)(i.h2,{id:"update-the-ca-certificates",children:"Update the ca-certificates"}),"\n",(0,c.jsx)(i.p,{children:"This will make the new CA file visible to the system."}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"sudo update-ca-certificates --verbose\n"})}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"--verbose"})," is added to get details of ca-certificate updation"]}),"\n"]}),"\n",(0,c.jsxs)(i.p,{children:["After this updation, a ",(0,c.jsx)(i.code,{children:".pem"})," file will be added to ",(0,c.jsx)(i.code,{children:"/etc/ssl/certs/"}),", you can ",(0,c.jsx)(i.code,{children:"ls"})," and verify it."]}),"\n",(0,c.jsx)(i.h2,{id:"check-if-ca-certificate-is-working",children:"Check if CA-Certificate is working"}),"\n",(0,c.jsx)(i.p,{children:"This is the step that breaks everything."}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{children:"python -c \"import requests; print(requests.get('https://pypi.org').status_code)\"\n"})}),"\n",(0,c.jsxs)(i.p,{children:["Change the ",(0,c.jsx)(i.code,{children:"python"})," with ",(0,c.jsx)(i.code,{children:"python3"})," if command shows python error."]}),"\n",(0,c.jsx)(i.p,{children:"You added the CA file, update the CA Certificate store but still things are not working."}),"\n",(0,c.jsx)(i.p,{children:"A common cause of this - current user (eg: appuser) cannot read that certificate file."}),"\n",(0,c.jsx)(i.h2,{id:"check-if-ca-file-is-readable-by-the-current-user",children:"Check if CA file is readable by the current user"}),"\n",(0,c.jsx)(i.p,{children:"If this works then your current user can read the CA file. And you have to follow some other helps to debug the issue, following this article won't help."}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"cat /etc/ssl/certs/CA_Certificate.pem\n"})}),"\n",(0,c.jsx)(i.p,{children:"If this works then your super-user (sudo / admin / root) user can only read the CA file. We need to change it."}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"sudo cat /etc/ssl/certs/CA_Certificate.pem\n"})}),"\n",(0,c.jsx)(i.h2,{id:"check-the-ca-file-permissions",children:"Check the CA file permissions"}),"\n",(0,c.jsxs)(i.p,{children:["Use ",(0,c.jsx)(i.code,{children:"ls -l"})," to see it, the ",(0,c.jsx)(i.code,{children:"-l"}),' option stands for "long format" which will display all the details such as File type, Permissions, Hard link count, Owner, Group, Size, Modification time, and File or Directory name']}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"ls -l /etc/ssl/certs/CA_Certificate.pem\n"})}),"\n",(0,c.jsxs)(i.p,{children:["If this is not giving output as ",(0,c.jsx)(i.code,{children:"lrwxrwxrwx 1 root root 52 Aug 26 15:18 /etc/ssl/certs/CA_Certificate.pem -> /usr/local/share/ca-certificates/CA_Certificate.crt"})]}),"\n",(0,c.jsxs)(i.p,{children:["Focus on the ",(0,c.jsx)(i.code,{children:"lrwxrwxrwx"}),", as it shows whether the file can be read by the current user. If not change the mode."]}),"\n",(0,c.jsx)(i.h3,{id:"change-the-mode",children:"Change the mode"}),"\n",(0,c.jsxs)(i.p,{children:["This mode change enables the current user to read the ",(0,c.jsx)(i.code,{children:"crt"})," file."]}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"sudo chmod 644 /usr/local/share/ca-certificates/CA_Certificate.crt\n"})}),"\n",(0,c.jsxs)(i.p,{children:["After this check the permission of the file again \u2192 ",(0,c.jsx)(i.code,{children:"ls -l /etc/ssl/certs/CA_Certificate.pem"})]}),"\n",(0,c.jsx)(i.h2,{id:"check-if-it-ca-certificate-is-working",children:"Check if it CA-Certificate is working"}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{children:"python -c \"import requests; print(requests.get('https://pypi.org').status_code)\"\n"})}),"\n",(0,c.jsx)(i.p,{children:"If its working then you're good to go. Follow below steps to make it persistent."}),"\n",(0,c.jsx)(i.h2,{id:"add-shell-variables",children:"Add Shell Variables"}),"\n",(0,c.jsx)(i.p,{children:"Bash"}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"export REQUESTS_CA_BUNDLE=/etc/ssl/certs/CA_Certificate.pem\r\nexport SSL_CERT_FILE=/etc/ssl/certs/CA_Certificate.pem\n"})}),"\n",(0,c.jsx)(i.p,{children:"Reload Bash"}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"source ~/.bashrc\n"})}),"\n",(0,c.jsx)(i.p,{children:"Fish Shell"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"Open the config file"}),"\n"]}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"nano ~/.config/fish/config.fish\n"})}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"Add the rules"}),"\n"]}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"set -x REQUESTS_CA_BUNDLE /etc/ssl/certs/CA_Certificate.pem\r\nset -x SSL_CERT_FILE /etc/ssl/certs/CA_Certificate.pem\n"})}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"Open a new terminal and check"}),"\n"]}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"echo $REQUESTS_CA_BUNDLE\r\necho $SSL_CERT_FILE\n"})}),"\n",(0,c.jsx)(i.h2,{id:"sample-usecase",children:"Sample Usecase"}),"\n",(0,c.jsx)(i.h3,{id:"docker-image-building",children:"Docker Image building"}),"\n",(0,c.jsx)(i.p,{children:"Docker will recreates everything similar to a virtual machine while building an image"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:["\n",(0,c.jsxs)(i.p,{children:["Go to the location of your ",(0,c.jsx)(i.code,{children:"dockerfile"})]}),"\n"]}),"\n",(0,c.jsxs)(i.li,{children:["\n",(0,c.jsx)(i.p,{children:"Copy the CA Certificate to that folder"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{children:"cp /etc/ssl/certs/CA_Certificate.pem ./CA_Certificate.pem\n"})}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"Inside the dockerfile add the line"}),"\n"]}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{children:"# Copy the cert into the container\r\nCOPY CA_Certificate.pem /usr/local/share/ca-certificates/CA_Certificate.crt\n"})}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"Build the docker image"}),"\n"]}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"docker build -t image_name .\n"})}),"\n",(0,c.jsx)(i.h3,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,c.jsx)(i.p,{children:"Docker Compose may raise SSL issue while trying to pull multiple services."}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"sudo mkdir -p /etc/docker/certs.d\n"})}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"sudo cp /etc/ssl/certs/CA_Certificate.pem /etc/docker/certs.d/docker.io/ca.crt\n"})}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-bash",children:"sudo systemctl restart docker\n"})})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,c.jsx)(i,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}}}]);